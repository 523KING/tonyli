var eic = { common: {}, expo: {}, ui: {} }; (function ($, _common) { _common.getCheckboxValues = function (name) { var ss = $("input[name='" + name + "']:checked"); var arr = []; for (var i = 0; i < ss.length; i++) { var s = $(ss[i]); arr.push(s.val()) } return arr }; $.fn.ctabs = function (options) { var defaults = { eventType: "click", attributeName: "href", initState: "", tabOnClass: "on" }; var settings = $.extend({}, defaults, options); settings.eventType = settings.eventType == "hover" ? "mouseover" : settings.eventType; var container = $(this); var tabs = container.find("a[" + settings.attributeName + '^="#"]'); tabs.each(function (i, n) { var tab = $(n); var contentSelector = tab.attr(settings.attributeName); tab.bind(settings.eventType, function () { tabs.each(function (ii, nn) { $($(nn).attr(settings.attributeName)).hide(); $(nn).removeClass(settings.tabOnClass) }); $(contentSelector).show(); $(this).addClass(settings.tabOnClass); return false }) }); if (settings.initState) { $(container.find("a[" + settings.attributeName + '="#' + settings.initState + '"]')[0]).trigger(settings.eventType) } else { $(tabs[0]).trigger(settings.eventType) } }; _common.toJson = function (str) { if (!str) { return {} } var ret = $.parseJSON(str); return ret }; (function ($cookie) { _common.cookie = {}; var _p = function (key, value, options) { var splitor = "|||"; var read = $cookie(key); if (value !== undefined) { if (read) { value = read + splitor + value } return $cookie(key, value, options) } if (!read) { return read } return read.split(splitor) }; _common.cookie.set = function (key, value, options) { return _p(key, value, options) }; _common.cookie.get = function (key) { return _p(key) }; _common.cookie.remove = function (key, options) { return $.removeCookie(key, options) } })($.cookie) })($, eic.common); (function ($, ns) { ns.showSuccess = function (title, content, done, okText) { done = done || function () { }; previewWindow("success", title, content, done, okText) }; ns.showError = function (title, content, done, okText) { done = done || function () { }; previewWindow("fail", title, content, done, okText) }; ns.showNotice = function (title, content, done, okText) { done = done || function () { }; previewWindow("common", title, content, done, okText) }; ns.show401 = function (retry) { retry = retry || function () { }; var c = $("<div></div>"); $("body").append(c.load("/account/login", function (response, status, xhr) { $(".401close").click(function () { c.remove() }); $("#loginForm").on("submit", function (event) { var t = $(this); event.preventDefault(); $.ajax({ url: t.attr("action"), type: t.attr("method"), data: t.serialize() }).done(function (data) { data = $.parseJSON(data); if (!data.Ok) { alert(data.Message) } else { var cbtn = $(".401close:first"); cbtn.trigger("click"); retry(); ns.refreshStatus() } }) }) }).centerFixed()) }; ns.bindLogin = function () { $(".login").click(function () { ns.show401() }) }; ns.refreshStatus = function () { $("#authBtn").load("/account/top_status", ns.bindLogin) }; ns.ajax = function (url, done, setting) { setting = setting || {}; setting.retry = setting.retry || function () { }; var fail = setting.fail || function (title, data) { ns.showNotice(title, data) }; var xhr = $.ajax(url, setting).done(function (data) { var r = eic.common.toJson(data); r.title = r.title || ""; if (r.done) { done(r.data, r.title) } else { if (r.status == 401) { ns.show401(setting.retry) } else { fail(r.title, r.data) } } }) } })($, eic.ui);